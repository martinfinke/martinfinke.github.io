<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <meta name=HandheldFriendly content=True> <meta name=MobileOptimized content=320> <meta name=viewport content="width=device-width"> <meta http-equiv=cleartype content=on> <meta property="fb:admins" content=100001493355877> <meta property="og:image" content="http://www.martin-finke.de/img/making_audio_plugins_thumbnail.png"> <meta property="og:image:type" content="image/png"> <meta property="og:image:width" content=100> <meta property="og:image:height" content=100> <title>Making Audio Plugins Part 4: VST and AU Targets - Martin Finke's Blog </title> <link rel=alternate href="/feed.xml" type="application/rss+xml" title="Music &amp; Programming"> <link href="http://fonts.googleapis.com/css?family=Domine:700|Inconsolata:400,700" rel=stylesheet type="text/css"> <link rel=stylesheet href='/css/4407aa6.css'> </head> <body class=article-detail> <header class=header> <div class=content-wrap> <h1>Making Audio Plugins Part 4: VST and AU Targets</h1> <div class=taglinks><a href="/tags/programming.html" class=taglink>Programming</a>, <a href="/tags/making_audio_plugins.html" class=taglink>Making Audio Plugins</a> </div> </div> </header> <div id=content> <div class=content-wrap> <article class=article> <section class=content><p><span class=caps>WDL</span>-<span class=caps>OL</span> makes it very easy to turn our standalone app into a <span class=caps>VST</span> or AudioUnit plugin. <span class=more></span> To build a <span class=caps>VST</span> version, change your scheme to <em><span class=caps>VST2</span></em> → <em>My Mac 64-Bit</em>. Hit <em>Run</em> and you shouldn’t get any errors, but nothing is being run! Open a Finder window and go to <em>~/Library/Audio/Plug-Ins/<span class=caps>VST</span></em> and you should see <em>MyFirstPlugin.vst</em> there. If you can’t see the <em>Library</em> folder in your home folder, press Cmd+Shift+G, paste in the path and hit&nbsp;Enter.</p> <p>The following is for Mac users with Xcode. For a guide on Windows, please see <a href="/articles/audio-plugins-004-vst-and-au/#windows_debugging_setup">below</a>.</p> <h2 id=debugging-using-xcode>Debugging using&nbsp;Xcode</h2> <p>To run the plugin, we need a host. Download the 64-bit version of <a href="http://reaper.fm/">Reaper</a> and drag it to your Applications folder. You can evaluate it for 60 days, after that you’re asked to purchase a license. We’re going to set things up so when we click <em>Run</em> in Xcode, it will start Reaper and connect the debugger. We’ll be able to use breakpoints just like with the standalone&nbsp;app.</p> <p><a name=edit_scheme></a> Go to <em>Product</em> → <em>Scheme</em> → <em>Edit Scheme…</em> and make sure you have selected <em>Run</em> in the list on the left side. Under <em>Executable</em>, select <em>Other…</em>:</p> <p><a href="/articles/audio-plugins-004-vst-and-au/edit-scheme.jpg"><img src="/articles/audio-plugins-004-vst-and-au/edit-scheme.jpg" alt="Edit Scheme"></a></p> <p>Use the dialog to find <em><span class=caps>REAPER64</span>.app</em>. Now it should look like&nbsp;this:</p> <p><a href="/articles/audio-plugins-004-vst-and-au/executable.jpg"><img src="/articles/audio-plugins-004-vst-and-au/executable.jpg" alt="REAPER64 selected"></a></p> <p>Click <em><span class=caps>OK</span></em> and then <em>Run</em> again. Reaper will start. Press Cmd+T (Ctrl+T on Windows) to insert a new Track, then click the <em><span class=caps>FX</span></em> button:</p> <p><a href="/articles/audio-plugins-004-vst-and-au/show-fx-window.jpg"><img src="/articles/audio-plugins-004-vst-and-au/show-fx-window.jpg" alt="FX Button"></a></p> <p>In the window that’s opened, enter <em>myfirstplugin</em> and it will show&nbsp;up:</p> <p><a href="/articles/audio-plugins-004-vst-and-au/select-plugin.jpg"><img src="/articles/audio-plugins-004-vst-and-au/select-plugin.jpg" alt="FX Button"></a></p> <p>Select it and click <em><span class=caps>OK</span></em>. The plugin will appear. The advantage over running standalone is that you can run any audio file through your plugin and hear what it does to the sound. This is much more interesting than being limited to your computer’s microphone. Also, you can use other plugins to inspect your own plugin’s output, which will come in handy later.<br>Download <a href="/articles/audio-plugins-004-vst-and-au/sine-110hz.flac">this</a> file and drag it onto the Track in Reaper. Make sure you drag it all the way to the left. Hit <em>space</em> to start playback and you’ll hear a low&nbsp;tone:</p> <p><a href="/articles/audio-plugins-004-vst-and-au/playback.png"><img src="/articles/audio-plugins-004-vst-and-au/playback.png" alt="Playing back audio in Reaper"></a></p> <p>For testing, it would be nice if the tone could play indefinitely until we hit <em>space</em> again. Hold the Cmd key and double-click the sound file in the track (<em>below</em> the filename). You will see how the file’s range gets selected (white). Then press <em>R</em> to toggle Repeat. Press <em>space</em> again and the tone should just keep on playing until you press it again. Turn the knob in the plugin and hear how you can change the&nbsp;volume!</p> <p><a href="/articles/audio-plugins-004-vst-and-au/playback-loop.png"><img src="/articles/audio-plugins-004-vst-and-au/playback-loop.png" alt="Looping in Reaper"></a></p> <p>There will be click sounds while you turn the knob; this is because we’re not interpolating between values and it creates small steps in the waveform. Now hit <em>Stop</em> in Xcode to quit&nbsp;Reaper.</p> <p>Building the AudioUnit version is easy: Just change the target to <em><span class=caps>AU</span></em>. Edit the <em>Run</em> scheme so it starts <em><span class=caps>REAPER64</span>.app</em> and click <em>Run</em>. The plugin will be built and put into <em>~/Library/Audio/Plug-Ins/Components</em>. Reaper will start and you should be able to load the <span class=caps>AU</span> version of your plugin just like the <span class=caps>VST</span>&nbsp;version.</p> <p>The whole process of running, creating a track etc. can get quite repetitive. I’m a big fan of optimizing things you do often. Running and testing your plugin is such a thing. When you have everything set in Reaper (i.e. your plugin is inserted on a track, and the sound is playing repeatedly), hit Cmd+S (Ctrl+S on Windows) to save the project. Save it to your Xcode project’s folder (<em>~/plugin-development/wdl-ol/IPlugExamples/MyFirstPlugin/</em>) and name it <em>reaper-project.<span class=caps>RPP</span></em>. </p> <p>In Xcode’s <em>Edit Scheme</em> screen, select the <em><span class=caps>VST2</span></em> scheme at the top. Now go to the <em>Arguments</em> tab and click the plus button below <em>“Arguments Passed On Launch”</em>. Drag the <em>reaper-project.<span class=caps>RPP</span></em> from your project folder to the newly created&nbsp;line:</p> <p><a href="/articles/audio-plugins-004-vst-and-au/run-reaper-arguments.jpg"><img src="/articles/audio-plugins-004-vst-and-au/run-reaper-arguments.jpg" alt=""></a></p> <p>Repeat this for the <span class=caps>AU</span> target. If you want, you can create a separate project for the <span class=caps>AU</span> version. From now on everytime you start Reaper it will run with everything in place. Awesome!</p> <p>If you want, play around a little with breakpoints and see how you can inspect plugin variables even though it’s not running directly inside&nbsp;Xcode!</p> <p><a name=windows_debugging_setup></a></p> <h2 id=debugging-on-windows>Debugging on&nbsp;Windows</h2> <p>Open Explorer and go to <em>C:\Program Files\</em>. Create a new folder and call it <em>vsthost</em>. Now <a href="http://www.hermannseib.com/english/savihost.htm">download Savihost</a> (you’ll want the <em>savihostx86.zip</em>) and unzip it. Copy the <em>savihost.exe</em> into the folder you just&nbsp;created:</p> <p><a href="/articles/audio-plugins-004-vst-and-au/savihost_folder.png"><img src="/articles/audio-plugins-004-vst-and-au/savihost_folder.png" alt=""></a></p> <p>Back in Visual C++, right-click the <em>MyFirstPlugin-vst2</em> project in the project explorer on the left. Select <em>Set as StartUp Project</em>. Press <em>F5</em> and it will run your plugin as <span class=caps>VST2</span> in&nbsp;Savihost:</p> <p><a href="/articles/audio-plugins-004-vst-and-au/savihost.png"><img src="/articles/audio-plugins-004-vst-and-au/savihost.png" alt=""></a></p> <p>If nothing appears, try clicking the different windows in the Taskbar; it should be there.<br>There’s one more thing to do: With the current configuration, Savihost will try to catch exceptions and prevent your plugin from crashing. This may be nice when we’re using our plugin on stage, but not for debugging purposes. In Visual C++, right-click <em>MyFirstPlugin-vst2</em> (in the project explorer on the left), and click <em>Properties</em>. In the following dialog, select <em>Debugging</em> on the left. On the right, append <code>/noexc /noft</code> to the parameters (make sure there’s a space between each&nbsp;parameter):</p> <p><a href="/articles/audio-plugins-004-vst-and-au/savihost_unsafe.png"><img src="/articles/audio-plugins-004-vst-and-au/savihost_unsafe.png" alt=""></a></p> <p>This will stop Savihost from catching exceptions, so now they will be passed through the Visual C++ debugger. Thanks to <em>arakula</em> for this&nbsp;hint!</p> <p>If you try to run the <span class=caps>VST3</span> version, you’ll most likely get an error like this (maybe not in&nbsp;German):</p> <p><a href="/articles/audio-plugins-004-vst-and-au/no_vst3_host.png"><img src="/articles/audio-plugins-004-vst-and-au/no_vst3_host.png" alt=""></a></p> <p>The <em>VST3PluginTestHost.exe</em> is part of the <span class=caps>VST3</span> <span class=caps>SDK</span> you <a href="/articles/audio-plugins-002-setting-up-wdl-ol/#copy_sdk_files">downloaded in part 2</a>. Just create the folder <em>C:\Program Files\Steinberg\VST3PluginTestHost\</em> and put the <em>VST3PluginTestHost.exe</em> in&nbsp;there.</p> <p><a name=warnings></a></p> <h2 id=inhibit-warnings-for-library-code-mac->Inhibit Warnings for Library Code&nbsp;(Mac)</h2> <p>This section is about Mac/Xcode. For Windows, please <a href="/articles/audio-plugins-004-vst-and-au/#warnings_windows">skip to the next&nbsp;section</a>.</p> <p>You may have noticed that we get a lot of&nbsp;warnings:</p> <p><a href="/articles/audio-plugins-004-vst-and-au/warnings.png"><img src="/articles/audio-plugins-004-vst-and-au/warnings.png" alt=""></a></p> <p>Warnings are very valuable for us because they can call our attention to possible bugs and problems with our code. The 22 warnings are from library code, so we can’t just go in there and fix them: If we update the library at some point, we’ll have to do it all over again. Just leaving them there is bad, too: If we get used to seeing the warning sign all the time, we probably won’t notice when the <em>22</em> turns into a <em>23</em> because there’s a warning about our own&nbsp;code.</p> <p>The best solution in my opinion is to inhibit warnings for library code. So when a warning appears, we know it’s relevant for us. The compiler flag to inhibit warnings is <code>-w</code>. Click on your project (blue icon) in the navigator, select the <em><span class=caps>APP</span></em> target, go to <em>Build Phases</em> and expand the <em>Compile Sources</em> section. Mark everything except for <em>MyFirstPlugin.cpp</em> and double-click a marked row in the <em>Compiler Flags</em> column. Type <code>-w</code> and hit <em>enter</em>:</p> <p><a href="/articles/audio-plugins-004-vst-and-au/inhibit-warnings.png"><img src="/articles/audio-plugins-004-vst-and-au/inhibit-warnings.png" alt=""></a></p> <p>Repeat this step for the <em><span class=caps>VST2</span></em> and <em><span class=caps>AU</span></em> targets (and any other targets you want to use). Now try to build again, and you’ll get only three warnings. The warning about <em>Validate Project Settings</em> is easily fixed: Double-click it, uncheck everything and click <em>Done</em>:</p> <p><a href="/articles/audio-plugins-004-vst-and-au/validate-project-settings.jpg"><img src="/articles/audio-plugins-004-vst-and-au/validate-project-settings.jpg" alt="Validate Project Settings"></a></p> <p>Now there are only two warnings&nbsp;left:</p> <p><a href="/articles/audio-plugins-004-vst-and-au/few-warnings.png"><img src="/articles/audio-plugins-004-vst-and-au/few-warnings.png" alt=""></a></p> <p>The warning about <em>InfoPlist.strings</em> encoding can be fixed by opening the file and setting it to <span class=caps>UTF</span>-8 using the <em>Utilities</em> on the right (click <em>Convert</em>):</p> <p><a href="/articles/audio-plugins-004-vst-and-au/unicode.jpg"><img src="/articles/audio-plugins-004-vst-and-au/unicode.jpg" alt="Setting to UTF-8"></a></p> <p>The warning about <em>extra tokens</em> can be silenced by surrounding the <code>#include</code> directive in <em>MyFirstPlugin.h</em>:</p> <pre><code class="lang-cpp"><span class="preprocessor">#pragma clang diagnostic push</span>
<span class="preprocessor">#pragma clang diagnostic ignored "-Wextra-tokens"</span>
<span class="preprocessor">#include "IPlug_include_in_plug_hdr.h"</span>
<span class="preprocessor">#pragma clang diagnostic pop</span>
</code></pre> <p>Now the <em><span class=caps>APP</span></em> and <em><span class=caps>AU</span></em> targets are without warnings. Building the <em><span class=caps>VST2</span></em> target warns you about <em>only one parameter on ‘main’ declaration</em>. Let’s fix this by by surrounding the <code>#include</code> directive in <em>MyFirstPlugin.cpp</em> (<em>not</em> .h!):</p> <pre><code class="lang-cpp"><span class="preprocessor">#include "MyFirstPlugin.h"</span>
<span class="preprocessor">#pragma clang diagnostic push</span>
<span class="preprocessor">#pragma clang diagnostic ignored "-Wmain"</span>
<span class="preprocessor">#include "IPlug_include_in_plug_src.h"</span>
<span class="preprocessor">#pragma clang diagnostic pop</span>
<span class="preprocessor">#include "IControl.h"</span>
<span class="preprocessor">#include "resource.h"</span>
</code></pre> <p>Build again and you’ll see that there are no warnings left. Clean! </p> <p><a name=warnings_windows></a></p> <h2 id=inhibit-warnings-for-library-code-windows->Inhibit Warnings for Library Code&nbsp;(Windows)</h2> <p>In general, <span class=caps>VS</span> C++ will give different warnings than the <span class=caps>GCC</span>/<span class=caps>LLVM</span> used on Mac. You can find all <span class=caps>VS</span> C++ 2010 warnings on the left side of <a href="http://msdn.microsoft.com/en-us/library/8x5x43k7(v=vs.100).aspx">this&nbsp;page</a>. </p> <p>For example, if you get warnings C4101 and C4129 from some <em>.h</em> file in <span class=caps>WDL</span>, you can ignore these: In <em>MyFirstPlugin.h</em>, put a <code>#pragma</code> before the <code>#include</code> line:</p> <pre><code class="lang-cpp"><span class="preprocessor">#pragma warning( suppress : 4101 4129 )</span>
<span class="preprocessor">#include "IPlug_include_in_plug_hdr.h"</span>
</code></pre> <p>The <code>suppress</code> means that warnings will only be ignored for the next line (which is the <code>#include</code>). So it will still warn you about all code after the <code>#include</code> (which is good). Note that you only write the numbers, without the “C”. You can also do this in <em>MyFirstPlugin.cpp</em>:</p> <pre><code class="lang-cpp"><span class="preprocessor">#pragma warning( suppress : 4101 4129 )</span>
<span class="preprocessor">#include "IPlug_include_in_plug_src.h"</span>
</code></pre> <p>This covers <em>.h</em> files from the library.<br>If you get warnings for a certain <em>.cpp</em> file, find it in the project explorer, right-click it and click “Properties”. In the dialog, select <em>C/C++</em> → <em>Advanced</em> on the left. On the right, you should get an option like <em>Disable certain warnings</em>:</p> <p><a href="/articles/audio-plugins-004-vst-and-au/disable_warnings_for_cpp_file.png"><img src="/articles/audio-plugins-004-vst-and-au/disable_warnings_for_cpp_file.png" alt=""></a></p> <p>Here, you can input a list of warning numbers, separated by semicolon. As you can see, it’s already ignoring four warnings for this file. Note that changes you make here only affect this particular <em>.cpp</em> file. So you’ll have to find the right warning numbers for each file and put them here. If you start a new project in the future, make sure you <code>duplicate</code> it from this one, so you don’t have to do it&nbsp;again.</p> <h2 id=clean->Clean!</h2> <p>Without globally “blinding” ourselves against useful compiler output, we have made it easier to see warnings that come up in our own code. In the <a href="/articles/audio-plugins-005-digital-distortion/">next post</a> we will get our hands dirty and write a nasty digital distortion&nbsp;plugin.</p> </section> </article> <div id=donation_prompt>If you found this useful, please feel free to <form action="https://www.paypal.com/cgi-bin/webscr" method=post target=_top class=donation-form> <input type=hidden name=cmd value=_s-xclick> <input type=hidden name=hosted_button_id value=JQDU8W5PJBWL6> <input type=hidden name=ref value="/articles/audio-plugins-004-vst-and-au/"> <input type=image src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_SM.gif" border=0 name=submit alt="PayPal - The safer, easier way to pay online!"><img alt="" border=0 src="https://www.paypalobjects.com/de_DE/i/scr/pixel.gif" width=1 height=1> </form>! </div> <iframe src="//www.facebook.com/plugins/like.php?href=http%3A%2F%2Fwww.martin-finke.de%2Fblog%2F&amp;width=450&amp;height=21&amp;colorscheme=light&amp;layout=button_count&amp;action=like&amp;show_faces=false&amp;send=false" scrolling=no frameborder=0 style="border: none; overflow: hidden; width: 200px; height: 21px;" allowtransparency=true></iframe> <div class=comments> <div id=disqus_thread></div> <script type="text/javascript">var disqus_shortname="martinfinke";(function(){var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src="//"+disqus_shortname+".disqus.com/embed.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)})();</script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <a href="http://disqus.com" class=dsq-brlink>comments powered by <span class=logo-disqus>| Disqus</span></a> </div> </div> </div> <footer> <div class=content-wrap> <div class=nav><a href="/">« Index</a></div> <section class=copy> <p>&copy; 2015 Martin Finke – <a href="/impressum.html" class=impressum-link>Impressum</a></p> </section> </div> </footer> <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script> <script>window.jQuery||document.write('<script src="/js/vendor/jquery-1.10.2.min.js"><\/script>');</script> <script type="text/javascript">$(document).ready(function(){$('a:link[href^=http]:not([href*="martin-finke.de"])').attr("target","_blank")});</script> <script type="text/javascript">var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-43375106-1"]);_gaq.push(["_trackPageview"]);(function(){var b=document.createElement("script");b.type="text/javascript";b.async=true;b.src=("https:"==document.location.protocol?"https://":"http://")+"stats.g.doubleclick.net/dc.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a)})();</script> </body> </html>