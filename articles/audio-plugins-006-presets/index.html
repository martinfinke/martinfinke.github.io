<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <meta name=HandheldFriendly content=True> <meta name=MobileOptimized content=320> <meta name=viewport content="width=device-width"> <meta http-equiv=cleartype content=on> <meta property="fb:admins" content=100001493355877> <meta property="og:image" content="http://www.martin-finke.de/img/making_audio_plugins_thumbnail.png"> <meta property="og:image:type" content="image/png"> <meta property="og:image:width" content=100> <meta property="og:image:height" content=100> <title>Making Audio Plugins Part 6: Presets - Martin Finke's Blog </title> <link rel=alternate href="/feed.xml" type="application/rss+xml" title="Music &amp; Programming"> <link href="http://fonts.googleapis.com/css?family=Domine:700|Inconsolata:400,700" rel=stylesheet type="text/css"> <link rel=stylesheet href='/css/4407aa6.css'> </head> <body class=article-detail> <header class=header> <div class=content-wrap> <h1>Making Audio Plugins Part 6: Presets</h1> <div class=taglinks><a href="/tags/programming.html" class=taglink>Programming</a>, <a href="/tags/making_audio_plugins.html" class=taglink>Making Audio Plugins</a> </div> </div> </header> <div id=content> <div class=content-wrap> <article class=article> <section class=content><p>Let’s add some presets to our distortion plugin! <span class=more></span> Presets allow your plugin to store values for its parameters. For now, a preset consists of a name and values for all the parameters. We will later see that you can actually store arbitrary data. Presets are sometimes called <em>programs</em>.</p> <p>First, let’s make the <span class=caps>GUI</span> a little wider so we can see the host’s preset selection better. Open <em>resource.h</em> and change the&nbsp;constant:</p> <pre><code class="lang-cpp"><span class="comment">// <span class="caps">GUI</span> default dimensions</span>
<span class="preprocessor">#define GUI_WIDTH 400</span>
</code></pre> <p>In <em>DigitalDistortion.h</em>, declare a private member&nbsp;function:</p> <pre><code class="lang-cpp"><span class="keyword">private</span>:
  <span class="keyword">double</span> mThreshold;
  <span class="keyword">void</span> CreatePresets();
</code></pre> <p>Add the implementation to <em>DigitalDistortion.cpp</em>:</p> <pre><code class="lang-cpp"><span class="keyword">void</span> DigitalDistortion::CreatePresets() {
  MakePreset(<span class="string">"clean"</span>, <span class="number">100.0</span>);
  MakePreset(<span class="string">"slightly distorted"</span>, <span class="number">80.0</span>);
  MakePreset(<span class="string">"woooo"</span>, <span class="number">40.0</span>);
  MakePreset(<span class="string">"waaaa"</span>, <span class="number">20.0</span>);
  MakePreset(<span class="string">"buzzz!!!"</span>, <span class="number">0.01</span>);
}
</code></pre> <p><code>MakePreset</code> takes the name of the preset, followed by values for all parameters. The order is defined in the <code>enum EParams</code> at the top of the file. Notice how the values are between 0 and 100, <em>not</em> between 0 and 1. They refer to the <em>parameter</em> <code>kThreshold</code>, not to the <code>mThreshold</code> member&nbsp;variable.</p> <p>Remove the <code>MakeDefaultPreset</code> call at the end of the constructor and instead call <code>CreatePresets</code>:</p> <pre><code class="lang-cpp">DigitalDistortion::DigitalDistortion(IPlugInstanceInfo instanceInfo)
  : IPLUG_CTOR(kNumParams, kNumPrograms, instanceInfo), mThreshold(<span class="number">1.</span>)
{
  <span class="comment">// ...</span>

  CreatePresets();
}
</code></pre> <p>Finally, we have to change the constant in line 13 (which is passed to the base class constructor&nbsp;call):</p> <pre><code class="lang-cpp"><span class="keyword">const</span> <span class="keyword">int</span> kNumPrograms = <span class="number">5</span>;
</code></pre> <p>If this is a higher number than the times you call <code>MakePreset</code>, the remaining presets will just be called “Empty”.<br>Run the <em><span class=caps>VST2</span></em> target. You may have to remove the plugin from your track and insert it again to get the newly added presets. You can change presets by using the dropdown above your plugin <span class=caps>GUI</span>. Change presets and watch how the knob takes different values and the distortion amount changes. Remember, when you change presets, <code>OnParamChange</code> is called for every parameter.<br>To the right of the dropdown menu there’s a button which opens the preset&nbsp;menu:</p> <p><a href="/articles/audio-plugins-006-presets/preset-menu.jpg"><img src="/articles/audio-plugins-006-presets/preset-menu.jpg" alt="Preset Menu"></a></p> <p>Try renaming a preset and turn the knob. These changes would be lost if you removed the plugin and inserted it again. To save them, click <em>“Export <span class=caps>VST</span> patch/bank file (.fxp/.fxb)…”</em> and save the file <em>test.fxb</em> to your desktop. Remove the plugin, insert it again and import <em>test.fxb</em> to restore your changes.<br><span class=caps>VST</span> plugins use the <em><span class=caps>FXP</span></em> format to store a single preset, and the <em><span class=caps>FX</span><strong>B</strong></em> format to store a bank of&nbsp;them.</p> <p>Run the <em><span class=caps>AU</span></em> target (you may have to <a href="/articles/audio-plugins-004-vst-and-au/#edit_scheme">Edit Scheme</a> first to make it run in Reaper). Make sure you actually insert the <em><span class=caps>AU</span></em> plugin and not the <em><span class=caps>VST</span></em>. Note how Reaper defaults to “No preset”, but all presets are there in the dropdown menu and everything works as expected. Saving presets is a little different: You can’t import or export banks. For more details on preset saving see <a href="http://forum.cockos.com/showpost.php?p=969598">this post</a> by Oli&nbsp;Larkin.</p> <p>Now let’s add a <a href="/articles/audio-plugins-007-gui/">better <span class=caps>GUI</span></a>!</p> </section> </article> <div id=donation_prompt>If you found this useful, please feel free to <form action="https://www.paypal.com/cgi-bin/webscr" method=post target=_top class=donation-form> <input type=hidden name=cmd value=_s-xclick> <input type=hidden name=hosted_button_id value=JQDU8W5PJBWL6> <input type=hidden name=ref value="/articles/audio-plugins-006-presets/"> <input type=image src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_SM.gif" border=0 name=submit alt="PayPal - The safer, easier way to pay online!"><img alt="" border=0 src="https://www.paypalobjects.com/de_DE/i/scr/pixel.gif" width=1 height=1> </form>! </div> <iframe src="//www.facebook.com/plugins/like.php?href=http%3A%2F%2Fwww.martin-finke.de%2Fblog%2F&amp;width=450&amp;height=21&amp;colorscheme=light&amp;layout=button_count&amp;action=like&amp;show_faces=false&amp;send=false" scrolling=no frameborder=0 style="border: none; overflow: hidden; width: 200px; height: 21px;" allowtransparency=true></iframe> <div class=comments> <div id=disqus_thread></div> <script type="text/javascript">var disqus_shortname="martinfinke";(function(){var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src="//"+disqus_shortname+".disqus.com/embed.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)})();</script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <a href="http://disqus.com" class=dsq-brlink>comments powered by <span class=logo-disqus>| Disqus</span></a> </div> </div> </div> <footer> <div class=content-wrap> <div class=nav><a href="/">« Index</a></div> <section class=copy> <p>&copy; 2015 Martin Finke – <a href="/impressum.html" class=impressum-link>Impressum</a></p> </section> </div> </footer> <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script> <script>window.jQuery||document.write('<script src="/js/vendor/jquery-1.10.2.min.js"><\/script>');</script> <script type="text/javascript">$(document).ready(function(){$('a:link[href^=http]:not([href*="martin-finke.de"])').attr("target","_blank")});</script> <script type="text/javascript">var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-43375106-1"]);_gaq.push(["_trackPageview"]);(function(){var b=document.createElement("script");b.type="text/javascript";b.async=true;b.src=("https:"==document.location.protocol?"https://":"http://")+"stats.g.doubleclick.net/dc.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a)})();</script> </body> </html>