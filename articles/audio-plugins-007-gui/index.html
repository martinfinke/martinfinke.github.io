<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <meta name=HandheldFriendly content=True> <meta name=MobileOptimized content=320> <meta name=viewport content="width=device-width"> <meta http-equiv=cleartype content=on> <meta property="fb:admins" content=100001493355877> <meta property="og:image" content="http://www.martin-finke.de/img/making_audio_plugins_thumbnail.png"> <meta property="og:image:type" content="image/png"> <meta property="og:image:width" content=100> <meta property="og:image:height" content=100> <title>Making Audio Plugins Part 7: GUI - Martin Finke's Blog </title> <link rel=alternate href="/feed.xml" type="application/rss+xml" title="Music &amp; Programming"> <link href="http://fonts.googleapis.com/css?family=Domine:700|Inconsolata:400,700" rel=stylesheet type="text/css"> <link rel=stylesheet href='/css/4407aa6.css'> </head> <body class=article-detail> <header class=header> <div class=content-wrap> <h1>Making Audio Plugins Part 7: GUI</h1> <div class=taglinks><a href="/tags/programming.html" class=taglink>Programming</a>, <a href="/tags/gui.html" class=taglink>GUI</a>, <a href="/tags/making_audio_plugins.html" class=taglink>Making Audio Plugins</a> </div> </div> </header> <div id=content> <div class=content-wrap> <article class=article> <section class=content><p>It’s time to create a better user interface for our digital distortion plugin. <span class=more></span> Here’s the look we’re going&nbsp;for:</p> <p><a href="/articles/audio-plugins-007-gui/gui.jpg"><img src="/articles/audio-plugins-007-gui/gui.jpg" alt="GUI Preview"></a></p> <p>It’s not <em>awesome</em>, and just to demonstrate how we can add graphics and – more interestingly – how to create the rotating&nbsp;knob.</p> <p><a href="/articles/audio-plugins-007-gui/gui.tif">Here</a>‘s the <span class=caps>TIFF</span> of the design. Open it in Photoshop (or your preferred tool) and have a look at the different layers and groups. As you can see, the only part that’s really going to change is the knob. So we can export the rest as one&nbsp;<span class=caps>PNG</span>:</p> <p><a href="/articles/audio-plugins-007-gui/background.png"><img src="/articles/audio-plugins-007-gui/background.png" alt=Background></a></p> <h2 id=adding-the-background-for-mac-builds>Adding the Background for Mac&nbsp;Builds</h2> <p>Click on the above image and save it to your desktop. Open the <em>DigitalDistortion</em> project in Xcode. In the project navigator, expand the <em>Resources</em> folder and drag your image into the <em>img</em> folder inside of&nbsp;that:</p> <p><a href="/articles/audio-plugins-007-gui/drag-into-xcode.jpg"><img src="/articles/audio-plugins-007-gui/drag-into-xcode.jpg" alt="Drag background image into Xcode"></a></p> <p>Make sure you check the <em>Copy items into folder</em> option and add it to all&nbsp;targets:</p> <p><a href="/articles/audio-plugins-007-gui/add-to-targets.jpg"><img src="/articles/audio-plugins-007-gui/add-to-targets.jpg" alt="Add to targets"></a></p> <h2 id=adding-the-background-for-windows-builds>Adding the Background for Windows&nbsp;Builds</h2> <p>For Visual Studio, adding a resource (like an image) to your project is a little different. <em>Adding to all targets</em> on Mac means that the image will be included into the <em>.app</em>, <em>.vst</em> and <em>.component</em> files you ship to your users.<br>To achieve this with Visual Studio, edit your project’s <em><Projectname>.rc</em> file. For this project it’s called <em>DigitalDistortion.rc</em>. When you open it, the top looks like&nbsp;this:</p> <pre><code class="lang-cpp"><span class="preprocessor">#include "resource.h"</span>

KNOB_ID       <span class="caps">PNG</span> KNOB_FN
</code></pre> <p>First, <em>resource.h</em> is included, so all the <code>#define</code>s from there are available here. The line below that declares that the knob should be included. So to include the background as well, add this line just below&nbsp;that:</p> <pre><code class="lang-cpp">BACKGROUND_ID       PNG BACKGROUND_FN
</code></pre> <p>We’ll add <code>BACKGROUND_ID</code> and <code>BACKGROUND_FN</code> to <em>resource.h</em> in a second.<br><strong>Whenever we add an image to our project, we have to to add a line like&nbsp;this.</strong></p> <h2 id=using-the-background>Using the&nbsp;Background</h2> <p>Let’s reference the image from our code. Go into <em>resource.h</em> and change the <span class=caps>GUI</span> size (around line&nbsp;62):</p> <pre><code class="lang-cpp"><span class="comment">// <span class="caps">GUI</span> default dimensions</span>
<span class="preprocessor">#define GUI_WIDTH 280</span>
<span class="preprocessor">#define GUI_HEIGHT 230</span>
</code></pre> <p>…and add the background image <span class=caps>ID</span> and&nbsp;filename:</p> <pre><code class="lang-cpp"><span class="comment">// Unique IDs for each image resource.</span>
<span class="preprocessor">#define KNOB_ID 101</span>
<span class="preprocessor">#define BACKGROUND_ID 102</span>

<span class="comment">// Image resource locations for this plug.</span>
<span class="preprocessor">#define KNOB_FN "resources/img/knob.png"</span>
<span class="preprocessor">#define BACKGROUND_FN "resources/img/background.png"</span>
</code></pre> <p>In <em>DigitalDistortion.cpp</em>, change the constructor code to attach <em>background.png</em> instead of the red&nbsp;color:</p> <pre><code class="lang-cpp"><span class="comment">// pGraphics-&gt;AttachPanelBackground(&amp;COLOR_RED);</span>
pGraphics-&gt;AttachBackground(BACKGROUND_ID, BACKGROUND_FN);
</code></pre> <p>That was easy! Run the <em><span class=caps>APP</span></em> target and you’ll see the nice&nbsp;background:</p> <p><a href="/articles/audio-plugins-007-gui/background-changed.jpg"><img src="/articles/audio-plugins-007-gui/background-changed.jpg" alt="Running APP target"></a></p> <p>If the background isn’t working on windows, you may have to put <em>background.png</em> inside the folder <em>DigitalDistortion\resources\img\</em>, so it’s found&nbsp;correctly.</p> <h2 id=adding-the-knob>Adding the&nbsp;knob</h2> <p>The knob is slightly more difficult. Have a look at the design again and you may see how the knob consists of a textured part and some reflections. When you turn a knob, the metal itself moves, but the lamp on your ceiling sure doesn’t! So some parts of the graphic should rotate (metal texture, the black arrow), while others should stay fixed (anything due to light). What about the “outer ring”? It has some contour, but all of that is due to incidence of light, so it shouldn’t rotate.<br>That’s why we can’t just export the knob in twelve-o’clock-position and rotate it at runtime.<br>To be more precise, there should be a knob <em>base</em> which <em>doesn’t</em> rotate. On top of that, we need the <em>metal texture</em> which <em>does</em> rotate. And finally we need another layer with the light reflections which <em>doesn’t</em> rotate. These are the three parts, exported separately (the black background is just added so you can see&nbsp;everything):</p> <p><p style="background: black; margin-left: auto; margin-right: auto; width: 125px;"> <a href="/articles/audio-plugins-007-gui/knob-base.png"><img src="/articles/audio-plugins-007-gui/knob-base.png" alt=""></a> <a href="/articles/audio-plugins-007-gui/metal-brush.png"><img src="/articles/audio-plugins-007-gui/metal-brush.png" alt=""></a> <a href="/articles/audio-plugins-007-gui/highlight.png"><img src="/articles/audio-plugins-007-gui/highlight.png" alt=""></a> </p> There’s a very good tool for this. It’s called <em>KnobMan</em>, it’s freeware and it’s made for this exact purpose. <a href="http://www.g200kg.com/en/software/knobman.html">Download JKnobMan</a> for your system, start it and load <a href="/articles/audio-plugins-007-gui/knob.knob">the knob file</a> I’ve&nbsp;prepared:</p> <p><a href="/articles/audio-plugins-007-gui/knobman.jpg"><img src="/articles/audio-plugins-007-gui/knobman.jpg" alt=Knobman></a></p> <p>All I’ve done is add the three layers and change some coordinates so the metal texture rotates correctly without moving around. There’s a <a href="http://www.g200kg.com/en/docs/knobman/overview.html">tutorial</a> available if you want to get deeper into the software.<br>Export (Cmd+E, Ctrl+E on Windows) the knob to a file and name it <em>knob.png</em> (or <a href="/articles/audio-plugins-007-gui/knob.png">download mine</a>). The <span class=caps>PNG</span> has 128 frames covering all rotations, and only the metal <span class=amp>&amp;</span> arrow are rotated. Nice!</p> <p>Back in Xcode, right-click the existing <em>knob.png</em> and click <em>Delete</em>. In the following prompt, select <em>Move to Trash</em>. Now drag the <em>knob.png</em> onto the <em>img</em> folder and do everything the same way as for the background image above.<br>Since the filename is the same, we can leave <em>resource.h</em> alone. Go straight into <em>DigitalDistortion.cpp</em> and change the <code>enum ELayout</code> as&nbsp;follows:</p> <pre><code class="lang-cpp"><span class="keyword">enum</span> ELayout
{
  kWidth = GUI_WIDTH,
  kHeight = GUI_HEIGHT,

  kThresholdX = <span class="number">79</span>,
  kThresholdY = <span class="number">62</span>,
  kKnobFrames = <span class="number">128</span>
};
</code></pre> <p>We don’t even have to tell <span class=caps>WDL</span> that the knob is bigger than the previous one! We just say <em>“the <span class=caps>PNG</span> has 128 frames in it”</em> and specify where the knob should be placed.<br>Run your plugin as <span class=caps>VST2</span> and check out how you can turn the knob and it will go through the rotation frames. What’s confusing, though, is that our plugin does <em>distortion</em> and having the knob at 100% gets us a clean&nbsp;sound!</p> <p><a name=correcting_knob_direction></a></p> <h2 id=correcting-the-knob-direction>Correcting the Knob&nbsp;Direction</h2> <p>Let’s change that in line&nbsp;98:</p> <pre><code class="lang-cpp">mThreshold = <span class="number">1</span> - (GetParam(kThreshold)-&gt;Value() / <span class="number">100.</span>);
</code></pre> <p>To prevent the <em>division by zero</em> problem described <a href="/articles/audio-plugins-005-digital-distortion/#no_division_by_zero">earlier</a>, we also have to modify line 33 so that the parameter defaults to <code>0</code> and will not exceed <code>99.99</code>:</p> <pre><code class="lang-cpp">GetParam(kThreshold)-&gt;InitDouble(<span class="string">"Threshold"</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">99.99</span>, <span class="number">0.01</span>, <span class="string">"%"</span>);
</code></pre> <p>If you run again, the plugin should work as expected. It might be a good idea to rename the variables from <code>Threshold</code> to something like <code>DistortionAmount</code>. The only thing still representing a threshold is the internal <code>mThreshold</code> variable.</p> <h2 id=summary>Summary</h2> <p>With minimal <span class=caps>DSP</span> code we have created a working distortion plugin with a custom user interface. This was to give you an idea of what goes into creating an audio plugin – sort of the <em>big picture</em>.<br>Now that we have an overview, we’re ready to get into more interesting signal processing: <a href="/articles/audio-plugins-008-synthesizing-waveforms/">The next post will be about synthesizing&nbsp;waveforms</a>.</p> <p>If you got stuck somewhere, you can download a <span class=caps>ZIP</span> with all files <a href="/articles/audio-plugins-007-gui/DigitalDistortion_Finished.zip">here</a>.</p> <h2 id=further-reading>Further&nbsp;Reading</h2> <ul> <li>There are a lot of free KnobMan examples <a href="http://www.kvraudio.com/forum/viewtopic.php?t=232629">here</a> and <a href="http://radorec.com/-skins/20-free-vst-knobs">here</a>.</li> </ul> <h2 id=credits>Credits</h2> <ul> <li>The metal look is based on <a href="http://psd.tutsplus.com/tutorials/interface-tutorials/creating-a-cool-brushed-metal-surface-in-photoshop/">this</a> Photoshop tutorial. Thanks to the&nbsp;author! </li> <li>Thanks to <a href="http://www.g200kg.com/">g200kg</a> for&nbsp;KnobMan!</li> </ul> </section> </article> <div id=donation_prompt>If you found this useful, please feel free to <form action="https://www.paypal.com/cgi-bin/webscr" method=post target=_top class=donation-form> <input type=hidden name=cmd value=_s-xclick> <input type=hidden name=hosted_button_id value=JQDU8W5PJBWL6> <input type=hidden name=ref value="/articles/audio-plugins-007-gui/"> <input type=image src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_SM.gif" border=0 name=submit alt="PayPal - The safer, easier way to pay online!"><img alt="" border=0 src="https://www.paypalobjects.com/de_DE/i/scr/pixel.gif" width=1 height=1> </form>! </div> <iframe src="//www.facebook.com/plugins/like.php?href=http%3A%2F%2Fwww.martin-finke.de%2Fblog%2F&amp;width=450&amp;height=21&amp;colorscheme=light&amp;layout=button_count&amp;action=like&amp;show_faces=false&amp;send=false" scrolling=no frameborder=0 style="border: none; overflow: hidden; width: 200px; height: 21px;" allowtransparency=true></iframe> <div class=comments> <div id=disqus_thread></div> <script type="text/javascript">var disqus_shortname="martinfinke";(function(){var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src="//"+disqus_shortname+".disqus.com/embed.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)})();</script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <a href="http://disqus.com" class=dsq-brlink>comments powered by <span class=logo-disqus>| Disqus</span></a> </div> </div> </div> <footer> <div class=content-wrap> <div class=nav><a href="/">« Index</a></div> <section class=copy> <p>&copy; 2015 Martin Finke – <a href="/impressum.html" class=impressum-link>Impressum</a></p> </section> </div> </footer> <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script> <script>window.jQuery||document.write('<script src="/js/vendor/jquery-1.10.2.min.js"><\/script>');</script> <script type="text/javascript">$(document).ready(function(){$('a:link[href^=http]:not([href*="martin-finke.de"])').attr("target","_blank")});</script> <script type="text/javascript">var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-43375106-1"]);_gaq.push(["_trackPageview"]);(function(){var b=document.createElement("script");b.type="text/javascript";b.async=true;b.src=("https:"==document.location.protocol?"https://":"http://")+"stats.g.doubleclick.net/dc.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a)})();</script> </body> </html>